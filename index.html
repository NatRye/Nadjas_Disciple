<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Nadja's Disciple</title>
</head>
<body>

<!--Download dataset knapper -->
    <div class="dropdown">
        <button class="dropbtn">Download Dataset</button>
        <div class="dropdown-content">
          <a class="fa fa-download" href="mismanaged-plastic-waste-per-capita.csv" download="mismanaged-plastic-waste-per-capita.csv">Per capita.csv</a>
          <a class="fa fa-download" href="plastic-waste-emitted-to-the-ocean.csv" download="plastic-waste-emitted-to-the-ocean.csv"> Emitted to ocean.csv</a>
          <a class="fa fa-download" href="plastic-waste-mismanaged 1.csv" download="plastic-waste-mismanaged 1.csv">Total waste mismanaged.csv</a>
        </div>
      </div>

    <!-- tekst og basal info-->
    <h1 id="overskrift">Plastic Pollution</h1>
    <h2 id="tekst"> </h2>

    <!-- knapper til skift af data på map-->
    <div id="knapboks">
    <p>Press a button to show the desired data:</p>
    <button id="dataCapita">Per Capita</button>
    <button id="dataOcean">Emitted To The Ocean</button>
    <button id="dataTotal">Total Mismanaged Plastic Waste</button>
    </div>

    <!-- d3 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"> </script>

    <!-- scripts til selve kortet -->
    <script src="kort.js"></script>
    <script src="http://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    <!-- Det element hvor mappet skal placeres -->
    <svg id="my_dataviz" width="1000" height="1000"></svg>

    <!-- Her laver vi et element der skal indeholder landenes data. Vi har givet dette element med id'et "country-info"-->
    <div id="country-info"></div>

    <div>
<h3 id="titelPerCapita", style="right: 5%; text-decoration: underline;">Mismanaged Plastic Waste Per Capita</h3>
    </div>

    <script>
        // Svg
        var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

        // Map og projection
        var path = d3.geoPath();
        var projection = d3.geoMercator()
        .scale(150)
        .center([0,20])
        .translate([width / 2, height / 2]);

        // Data map for hvert dataset
        var dataMapToShow = []; //Map til at blive vist
        var dataMap1 = d3.map(); //Map for datasæt 1
        var dataMap2 = d3.map(); //Map for datasæt 2
        var dataMap3 = d3.map(); //Map for datasæt 3

        // Load external data and boot
        d3.queue()
        .defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson") //topo
        .defer(d3.json, "http://localhost:3000/datacapitA")//data1
        .defer(d3.json, "http://localhost:3000/dataocean")//data2
        .defer(d3.json, "http://localhost:3000/datatotal")//data3
        .await(ready);

        // Funktion der filtrere Antarktis ud
        function filterAntarctica(data) {
        return data.features.filter(d => d.id !== "ATA");
        }
        

        //Funktion der viser landendes data i en div med id'et "country-info" 
        function showCountryData(country) {
            var infoBox = d3.select('#country-info');

            // Transistion der starter på infoboxen, som så derefter kører functionen med if statements der afgør hvilket datasæt der skal vises
            infoBox.transition()
                .duration(300)
                .style('opacity', 0)
                .on('end', function () {
                infoBox.html('<h2>' + country.properties.name + '</h2>');

                const dataValue = dataMapToShow.get(country.id) || 'Data not available';
                let dataType = '';

                if (dataMapToShow === dataMap1) {
                    dataType = 'Mismanaged Plastic Waste Per Capita in Kg';

                } else if (dataMapToShow === dataMap2) {
                    dataType = 'Plastic Waste Emitted To The Ocean in Tons';

                } else if (dataMapToShow === dataMap3) {
                    dataType = 'Total Plastic Waste Mismanaged in Tons';
                }

                infoBox.append('p')
                .html(dataType + ': <span class="data-value">' + dataValue + '</span>');

                // Transistion er indpakket rundt om hele indholdet 
                infoBox.transition()
                .duration(300)
                .style('opacity', 1);
            });
        }
        

        //Funktion der kaldes på når dataen loader ind
        function ready(error, topo, data1, data2, data3) {

            // Filtrere Antarktis fra topo
            topo.features = filterAntarctica(topo);

            console.log(topo);
            console.log(data1);//data per capita (World Map)
            console.log(data2);//data emitted to the ocean (World Map)
            console.log(data3);//data mismanaged plastic waste (World Map)
            console.log(dataMapToShow);
           
            //kolonner i hvert dataset udvælges og knyttes til en variabel
            let showData1 = data1.data;
            showData1.forEach(element => {
                dataMap1.set(element.code, +element.mismanaged);
            });

            let showData2 = data2.data;
            showData2.forEach(element => {
                dataMap2.set(element.code, +element.mismanaged);
            });

            let showData3= data3.data;
            showData3.forEach(element => {
                dataMap3.set(element.code, +element.mismanaged);
            });


            //Når musen holdes over et land udfø
            let mouseOver = function(d) {
                d3.selectAll(".Country")
                .transition()
                .duration(0)
                .style("opacity", .5)
                d3.select(this)
                .transition()
                .duration(0)
                .style("opacity", 1)
                .style("stroke", "black")
            }

            //Dette sker når musen forlader et land
            let mouseLeave = function(d) {
                d3.selectAll(".Country")
                .transition()
                .duration(0)
                .style("opacity", .8)
                d3.select(this)
                .transition()
                .duration(0)
                .style("stroke", "black")
            }


            // Event listeners til skifte datasæt med dataset buttons
            document.getElementById('dataCapita').addEventListener('click', function() {
                dataMapToShow = dataMap1;
                updateMap('dataCapita');
                var currentLegend = updateLegend('dataCapita');
            });

            document.getElementById('dataOcean').addEventListener('click', function() {
                dataMapToShow = dataMap2;
                updateMap('dataOcean');
                var currentLegend = updateLegend('dataOcean');
            });

            document.getElementById('dataTotal').addEventListener('click', function() {
                dataMapToShow = dataMap3;
                updateMap('dataTotal');
                var currentLegend = updateLegend('dataTotal');
            });


            // Function to update the map based on the selected dataset
            function updateMap(id) {
                svg.selectAll("path")
                .data(topo.features)
                .transition()
                .duration(1000)
                .attr("fill", function (d) {
                    var currentColorScale = updateColor(id);
                    d.total = dataMapToShow.get(d.id) || 0;
                    return currentColorScale(d.total);
                });
            }

            
            // Funktion der finder en farveskala baseret på valgt dataset
            function updateColor(id) {
                if (id === "dataCapita") {
                    return colorScale1;
                } else if (id === "dataOcean") {
                    return colorScale2;
                } else if (id === "dataTotal") {
                    return colorScale3;
                } else {
                    return colorScale1; // Default
                }
            }
            

            // Function to update the legend based on the selected dataset
            function updateLegend(id) {

                // Remove the existing legend
                svg.selectAll(".legend").remove();

                    // Define legend elements dynamically based on the selected dataset
                    var currentLegend;
                    if (id === "dataCapita") {
                        currentLegend = {
                            x: 70,
                            y: [100, 120, 140, 160, 180],
                            fill: colorScale1.range(),
                            text: ["1 Tons", "10 Tons", "15 Tons", "20 Tons", "50 Tons"]
                        };
                    } else if (id === "dataOcean") {
                        currentLegend = {
                            x: 70,
                            y: [100, 120, 140, 160, 180],
                            fill: colorScale2.range(),
                            text: ["10 Tons", "250 Tons", "1.000 Tons", "10.000 Tons", "50.000 Tons"]
                        };
                    } else if (id === "dataTotal") {
                        currentLegend = {
                            x: 70,
                            y: [100, 120, 140, 160, 180],
                            fill: colorScale3.range(),
                            text: ["500 Tons", "50.000 Tons", "100.000 Tons", "10 mil Tons", "20 mil Tons"]
                        };
                    } else {
                        currentLegend = {}; // Default
                    }

                    

                // Loop through the legend data and create legend squares and text
                currentLegend.y.forEach((y, index) => {
                    // Legend squares
                    svg.append("rect")
                        .transition()
                        .duration(1000)
                        .attr("x", currentLegend.x)
                        .attr("y", y)
                        .attr("width", 20)
                        .attr("height", 20)
                        .style("fill", currentLegend.fill[index])
                        .attr("class", "legend")
                        

                    // Legend text
                    svg.append("text")
                        .attr("x", currentLegend.x + 20)
                        .attr("y", y + 10)
                        .text(currentLegend.text[index])
                        .style("font-size", "15px")
                        .attr("alignment-baseline", "middle")
                        .attr("class", "legend");
                });
                
                function updateLegend(id) {
                    // Remove the existing legend
                    svg.selectAll(".legend").remove();

                    // Show/hide the legend based on the button click
                    if (id === "dataCapita") {
                        svg.selectAll(".legend").style("display", "block");
                    } else if (id === "dataOcean") {
                        svg.selectAll(".legend").style("display", "none");
                    } else if (id === "dataTotal") {
                        svg.selectAll(".legend").style("display", "none");
                    } else {
                        svg.selectAll(".legend").style("display", "none"); // Default
                    }
                }
            }

            //Skaleringer af farve
            var colorScale1 = d3.scaleThreshold()
            .domain([1, 2, 5, 8, 10, 15, 20, 25, 35, 50])
            .range(d3.schemeYlOrBr[9]);

            var colorScale2 = d3.scaleThreshold()
            .domain([10, 50, 100, 250, 500, 1000, 5000, 10000, 20000, 50000])
            .range(d3.schemeBlues[9]);

            var colorScale3 = d3.scaleThreshold()
            .domain([500, 2000, 10000, 50000, 100000, 500000, 1000000, 1500000, 200000000])
            .range(d3.schemeReds[9]);


            // Draw the map
            svg.append("g")
            .selectAll("path")
            .data(topo.features)
            .enter()
            .append("path")

            // draw each country
            .attr("d", d3.geoPath()
                .projection(projection)
            )
            .style("stroke", "black")
            .attr("class", function(d){ return "Country" } )
            .style("opacity", .8)
            .on("mouseover", mouseOver )
            .on("mouseleave", mouseLeave )

            // her køres den funktion vi lavede før, med at vise landene.    
            .on("click", function(d) {  
                showCountryData(d);
            });
            }
    </script>


    <!--------------------------------------------------------------------------------------------------------------------------->
    <!--Bar charts--> 
  
<div id="barchart1">

    <script>

    // set the dimensions and margins of the graph
    const margin = { top: 10, right: 30, bottom: 90, left: 60 },
    bredde = 600 - margin.left - margin.right,
    højde = 500 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    const svg1 = d3.select("#barchart1")
        .append("svg")
        .attr("width", bredde + margin.left + margin.right + 700)  // Increased width for text
        .attr("height", højde + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    // dataset(data.data) 
        fetch('http://localhost:3000/barchart1')
        .then(response => response.json())
        .then(result => {
    const data = result.data; // Access the data property

    descriptionText = "This bar chart visualizes the extent of plastic pollution\n on a per capita basis across different countries.\n The height of each bar represents\n the amount of mismanaged plastic waste,\n measured in kilograms, for each country's population.\n A higher bar indicates a higher level of plastic waste\n generated per person.\n\n\n The chart aims to highlight variations\n in the mismanagement of plastic waste,\n emphasizing the need for sustainable waste management \n practices to mitigate the environmental impact of plastic pollution.\n Explore the data to gain insights\n into the countries that face significant challenges in\n handling plastic waste on a per capita basis. ";

    svg1.append("text")
        .attr("x", bredde + margin.right - 30)  // Adjusted x position
        .attr("y", højde / 6)  // Adjusted y position
        .attr("transform", "rotate(0)")
        .style("text-anchor", "start")  // Changed text-anchor to "start"
        .style("font-size", "20px")  // Changed font size
        .style("font-family", "Roobert,-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif")
        .selectAll("tspan")
        .data(descriptionText.split("\n"))
        .enter()
        .append("tspan")
        .attr("x", bredde + margin.right - 30)  // Same x position for each line
        .attr("dy", "1em")  // Adjust vertical spacing between lines
        .text(d => d);

     // X axis
    const x = d3.scaleBand()
        .range([0, bredde])
        .domain(data.map(d => d.entity))
        .padding(0.2);
    svg1.append("g")
        .attr("transform", `translate(0,${højde})`)
        .call(d3.axisBottom(x))
        .selectAll("text")
        .attr("transform", "translate(-10,0)rotate(-45)")
        .style("text-anchor", "end");

     // Y axis label
    svg1.append("text")
        .attr("text-anchor", "center")
        .attr("y", -45)
        .attr("x", -250)  
        .style("font-size", "20px")
        .attr("transform", "rotate(-90)")
        .text("Kg. per year");

    // Add Y axis
    const y = d3.scaleLinear()
        .domain([0, d3.max(data, d => +d.mismanaged)])
        .range([højde, 0]);
    svg1.append("g")
        .call(d3.axisLeft(y));

    //Når musen holdes over et land udføres
    let mouseOverBar = function(d) {
    // Tooltip
    const tooltip = svg1.append("text")
        .attr("class", "tooltip")
        .text(d.mismanaged)
        .attr("x", x(d.entity) + x.bandwidth() / 2)
        .attr("y", y(d.mismanaged) - 2)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "12px")
        .attr("fill", "black");

    // Highlight the bar
    d3.select(this)
        .style("opacity", 0.25)
        .style("stroke", "black");
};

    // Hide value on mouseleave
    let mouseLeaveBar = function() {
    // Remove tooltip
    svg1.selectAll(".tooltip").remove();

    // Unhighlight the bar
    d3.select(this)
        .style("opacity", 1)
        .style("stroke", "none");
};

    // Create a linear color scale
    const colorScale = d3.scaleLinear()
        .domain([0, d3.max(data, d => +d.mismanaged)])
        .range(["orange", "red"]); // Adjust the range of colors as needed



    // Bars
    svg1.selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
        .attr("x", d => x(d.entity))
        .attr("width", x.bandwidth())
        .attr("fill", d => colorScale(d.mismanaged)) 
        .attr("y", d => y(0)) // Start at the base
        .attr("height", 0)    // Initially, the height is 0
        .on("mouseover", mouseOverBar)
        .on("mouseleave", mouseLeaveBar);

    // Animation
    svg1.selectAll("rect")
        .transition()
        .duration(800)
        .attr("y", d => y(d.mismanaged))
        .attr("height", d => højde - y(d.mismanaged))
        .delay((d, i) => i * 100);
    })
        .catch(error => console.error('Error fetching data:', error));

    </script>



</script>
</div>





</body>
</html>

