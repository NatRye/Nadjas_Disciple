<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Nadja's Disciple</title>
</head>
<body>
<!--Download dataset knapper -->
    <div class="dropdown">
        <button class="dropbtn">Download Dataset</button>
        <div class="dropdown-content">
          <a class="fa fa-download" href="mismanaged-plastic-waste-per-capita.csv" download="mismanaged-plastic-waste-per-capita.csv">Per capita.csv</a>
          <a class="fa fa-download" href="plastic-waste-emitted-to-the-ocean.csv" download="plastic-waste-emitted-to-the-ocean.csv"> Emitted to ocean.csv</a>
          <a class="fa fa-download" href="plastic-waste-mismanaged 1.csv" download="plastic-waste-mismanaged 1.csv">Total waste mismanaged.csv</a>
        </div>
      </div>

    <!-- tekst og basal info-->
    <h1 id="overskrift">Plastik Pollution</h1>
    <h2 id="tekst">tekst </h2>

    <!-- knapper til skift af data på map-->
    <button id="dataCapita">Datasæt 1</button>
    <button id="dataOcean">Datasæt 2</button>
    <button id="dataTotal">Datasæt 3</button>

    <!-- -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"> </script>
    <script>
        //magic
        d3.json("http://localhost:3000/datacapita").then(function (data) {
            console.log(data);
        })
    </script>

        <!-- scripts til selve kortet -->
    <script src="kort.js"></script>
    <script src="http://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    <!-- Det element hvor mappet skal placeres -->
    <svg id="my_dataviz" width="1000" height="1000"></svg>

    <!-- Her laver vi et element der skal indeholder landenes data. Vi har givet dette element med id'et "country-info"-->
    <div id="country-info" 
         style="position: fixed; 
         top: 20px; 
         right: 20px; 
         background-color: white; 
         padding: 10px; 
         border: 1px solid black;">
    </div>
    <div>Ollo boloo</div>
    


    <script>
        // Svg
        var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

        // Map og projection
        var path = d3.geoPath();
        var projection = d3.geoMercator()
        .scale(150)
        .center([0,20])
        .translate([width / 2, height / 2]);

        // Data map for hvert dataset
        var dataMapToShow = []; //Map til at blive vist
        var dataMap1 = d3.map(); //Map for datasæt 1
        var dataMap2 = d3.map(); //Map for datasæt 2
        var dataMap3 = d3.map(); //Map for datasæt 3

        // Load external data and boot
        d3.queue()
        .defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson") //topo
        .defer(d3.json, "http://localhost:3000/datacapitA")//data1
        .defer(d3.json, "http://localhost:3000/dataocean")//data2
        .defer(d3.json, "http://localhost:3000/datatotal")//data3
        .await(ready);

        //Funktion der viser landendes data i elementet med id'et "country-info"
        function showCountryData(country) {
            var infoBox = document.getElementById('country-info');
            infoBox.innerHTML = '<h2>' + country.properties.name + '</h2>';

            if (dataMapToShow === dataMap1) {
                infoBox.innerHTML += '<p>Mismanaged Plastic Waste Per Capita in Kg: ' + (dataMap1.get(country.id) || 'Data not available') + '</p>';

            } else if (dataMapToShow === dataMap2) {
                infoBox.innerHTML += '<p>Plastic Waste Emitted To The Ocean in Tons: ' + (dataMap2.get(country.id) || 'Data not available') + '</p>';
                
            } else if (dataMapToShow === dataMap3) {
                infoBox.innerHTML += '<p>Total Plastic Waste Mismanaged in Tons: ' + (dataMap3.get(country.id) || 'Data not available') + '</p>';
            }
        }
        
        

        //Funktion der kaldes på når dataen loader ind
        function ready(error, topo, data1, data2, data3) {
            console.log(topo);
            console.log(data1);
            console.log(data2);
            console.log(data3);
            console.log(dataMapToShow);
           
            //kolonner i hvert dataset udvælges og knyttes til en variabel
            let showData1 = data1.data;
            showData1.forEach(element => {
                dataMap1.set(element.code, +element.mismanaged);
            });

            let showData2 = data2.data;
            showData2.forEach(element => {
                dataMap2.set(element.code, +element.mismanaged);
            });

            let showData3= data3.data;
            showData3.forEach(element => {
                dataMap3.set(element.code, +element.mismanaged);
            });

            


            //Når musen holdes over et land udfø
            let mouseOver = function(d) {
                d3.selectAll(".Country")
                .transition()
                .duration(0)
                .style("opacity", .5)
                d3.select(this)
                .transition()
                .duration(0)
                .style("opacity", 1)
                .style("stroke", "black")
            }

            //Dette sker når musen forlader et land
            let mouseLeave = function(d) {
                d3.selectAll(".Country")
                .transition()
                .duration(0)
                .style("opacity", .8)
                d3.select(this)
                .transition()
                .duration(0)
                .style("stroke", "black")
            }

            //Eventlistener til at skifte datasæt med

            // Event listeners for dataset buttons
            document.getElementById('dataCapita').addEventListener('click', function() {
                dataMapToShow = dataMap1;
                updateMap('dataCapita');
            });

            document.getElementById('dataOcean').addEventListener('click', function() {
                dataMapToShow = dataMap2;
                updateMap('dataOcean');
            });

            document.getElementById('dataTotal').addEventListener('click', function() {
                dataMapToShow = dataMap3;
                updateMap('dataTotal');
            });

            // Function to update the map based on the selected dataset
            function updateMap(id) {
                svg.selectAll("path")
                    .data(topo.features)
                    .transition()
                    .duration(1000)
                    .attr("fill", function (d) {
                        var currentColorScale = updateColor(id);
                        d.total = dataMapToShow.get(d.id) || 0;
                        return currentColorScale(d.total);
                    });
            }
            
            // Funktion der finder en farveskala baseret på valgt dataset
            //Skalering af farve
            function updateColor(id) {
                if (id === "dataCapita") {
                    return colorScale1;
                } else if (id === "dataOcean") {
                    return colorScale2;
                } else if (id === "dataTotal") {
                    return colorScale3;
                } else {
                    return colorScale1; // Default
                }
            }
            

            var colorScale1 = d3.scaleThreshold()
                .domain([1, 2, 5, 8, 10, 15, 20, 25, 35, 50])
                .range(d3.schemeReds[9]);

            var colorScale2 = d3.scaleThreshold()
                .domain([10, 50, 100, 250, 500, 1000, 5000, 10000, 20000, 50000])
                .range(d3.schemeBlues[9]);

            var colorScale3 = d3.scaleThreshold()
                .domain([500, 2000, 10000, 50000, 100000, 500000, 1000000, 1500000, 200000000])
                .range(d3.schemeReds[9]);


            // Draw the map
            svg.append("g")
                .selectAll("path")
                .data(topo.features)
                .enter()
                .append("path")

                // draw each country
                .attr("d", d3.geoPath()
                    .projection(projection)
                )

                .style("stroke", "black")
                .attr("class", function(d){ return "Country" } )
                .style("opacity", .8)
                .on("mouseover", mouseOver )
                .on("mouseleave", mouseLeave )

                // her køres den funktion vi lavede før, med at vise landene.
                .on("click", function(d) {  
                        showCountryData(d);
                }
            );
        }
    </script>
</body>
</html>

